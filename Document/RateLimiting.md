# RateLimiting
大家好，我是jimmy，今天我来给大家讲解一下api的rate limiting。也就是API的限流。任何一个项目如果没有这一层的防御的话，它就会像纸糊的系统，可以被人轻松的攻击，网站奔溃。今天我就讲解一下实际项目中如果有效对这类攻击进行防御。如果觉的我的频道有帮助到你的话，请先加个关注。

# why
首先为什么我们看下为什么所有系统都需要rate limiting。任何的网络应用服务都是由后端一系列服务的提供支持的。既然由服务器支持，那么服务器一定是有资源限制的。其中包括了，CPU，memeory，和数据库等等限制。就算我们后端一般不止一台服务器，有负载均衡来平衡各个服务器之间的请求数量，但服务的资源肯定是有上限的。我们希望这些资源能够运行正常，并且最大化的服务我们的正常用户。

但这个世界上，最不缺少的就是有一些充满破环好奇心的小朋友，想考研一下你的网站。比如你开发了一个类似微博，或者论坛类的网站，有人写了个脚本，开始疯狂随机发一些微博和留言，比如一分钟内，发了10w的帖子之类的。那么你这个网站肯定是轻松挂掉了。这种时候，我们的系统需要对每个用户在一定时间内能够发出的请求做出限制防止这种破坏，比如我们微博的网站上，就明确的记载了的请求的限制。再比如就是有人注册了一堆账号，又开始跑一个脚本，在多个用户名下，开始攻击，破掉了你加的用户请求数的限制。这个系统就又崩掉了。这个时候，系统意识到需要对用户ip也进行防御。最后，有人非常不怀好意，开始在全球的范围的地点进行攻击，那么这就是一个传说中DDoS攻击。很多大网站每天也经常被这种攻击高挂。很多时候我们需要在使用第三放专业的DDos的工具进行防御。

# Rate limit的种类
一般需要在三中rate limiter的种类。一种是在客户的rate limiter，一个中是全局的rate limiter，一种单个机器的limtier。全方位的rate limiter才能保证我们的系统安全，程序员的头发健在。一般客户端的rate limiter的实现相对简单，我就不做讲解。全局的limiter实现相对复杂，本期视频后面会做一个讲解，server端的limiter一般有很多类包我们可以直接拿来使用。本期视频后面也会讲解一个asp.net中好用的类包。

# Rate limit的算法
* Token bucket
这种算法就是在每一个时间的区间内，记录请求的数量，但数量超过上线时，则对器进行拦截返回错误。这种方法的好处是相对来说，易于实现。但有点小问题就是，如果有人在区间的边沿进行攻击，我们的服务可能会收到两倍的攻击量。这个两倍的估计量则有可能破坏我的系统。

* Sliding window
这种算法是对前面算法的一种优化。与token bucket的不同的时，sliding windows，不仅记录一个请求数量，它还记录了所有请求的时间戳。当当前请求到达我们的rate limiter的时候，我们会先移除最近一个时间窗口之外的旧的请求。然后再判断当前窗口中的请求数量。这样，我们就可以避免了token bucket的算法问题。

# 实现

